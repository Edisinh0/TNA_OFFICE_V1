{"ast":null,"code":"/**\n * TNA Office - Cliente API Centralizado\n *\n * Este modulo provee un cliente Axios configurado con:\n * - Interceptores de autenticacion (JWT)\n * - Manejo automatico de errores 401 (sesion expirada)\n * - URL base configurada via variable de entorno VITE_API_URL\n *\n * USO:\n * import apiClient from '../utils/api';\n * const response = await apiClient.get('/offices');\n * const data = await apiClient.post('/sales', { ... });\n */\n\nimport axios from 'axios';\nimport { getAuthHeader, logout } from './auth';\n\n// Variable de entorno para Vite (debe comenzar con VITE_)\n// En desarrollo: VITE_API_URL=http://localhost:8001/api\n// En produccion: VITE_API_URL=https://tu-dominio.com/api\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8001/api';\n\n// Crear instancia de Axios con configuracion base\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 30000,\n  // 30 segundos de timeout\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n/**\n * Interceptor de Request\n * Agrega automaticamente el header de autorizacion JWT a todas las peticiones\n */\napiClient.interceptors.request.use(config => {\n  const authHeader = getAuthHeader();\n  if (authHeader.Authorization) {\n    config.headers = {\n      ...config.headers,\n      ...authHeader\n    };\n  }\n  return config;\n}, error => {\n  console.error('[API] Error en request:', error);\n  return Promise.reject(error);\n});\n\n/**\n * Interceptor de Response\n * Maneja automaticamente errores de autenticacion (401)\n * redirigiendo al usuario a la pagina de login\n */\napiClient.interceptors.response.use(response => response, error => {\n  var _error$response;\n  // Manejar error de sesion expirada o no autorizado\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n    console.warn('[API] Sesion expirada o no autorizada. Redirigiendo a login...');\n    logout();\n    window.location.href = '/login';\n  }\n\n  // Manejar errores de red\n  if (!error.response) {\n    console.error('[API] Error de red:', error.message);\n  }\n  return Promise.reject(error);\n});\n\n/**\n * Funcion helper para descargar archivos (reportes, etc.)\n * Maneja blobs y crea links de descarga automaticamente\n *\n * @param {string} endpoint - Endpoint del reporte (ej: '/reports/sales/excel')\n * @param {string} filename - Nombre del archivo a descargar\n * @returns {Promise<void>}\n */\nexport const downloadFile = async (endpoint, filename) => {\n  try {\n    const response = await apiClient.get(endpoint, {\n      responseType: 'blob'\n    });\n    const blob = new Blob([response.data], {\n      type: response.headers['content-type'] || 'application/octet-stream'\n    });\n    const url = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url);\n    return {\n      success: true\n    };\n  } catch (error) {\n    console.error('[API] Error descargando archivo:', error);\n    throw error;\n  }\n};\n\n// Exportar la URL base para usos especiales (WebSockets, etc.)\nexport const API_URL = API_BASE_URL;\n\n// Alias para compatibilidad con codigo existente (FanPage, OfficesFanPage, etc.)\nexport const API = API_BASE_URL;\n\n// Exportar el cliente como default\nexport default apiClient;","map":{"version":3,"names":["axios","getAuthHeader","logout","API_BASE_URL","import","meta","env","VITE_API_URL","apiClient","create","baseURL","timeout","headers","interceptors","request","use","config","authHeader","Authorization","error","console","Promise","reject","response","_error$response","status","warn","window","location","href","message","downloadFile","endpoint","filename","get","responseType","blob","Blob","data","type","url","URL","createObjectURL","link","document","createElement","download","body","appendChild","click","removeChild","revokeObjectURL","success","API_URL","API"],"sources":["/Users/eddiecerpa/Downloads/TNAOffice_MariaDB-2/frontend/src/utils/api.js"],"sourcesContent":["/**\n * TNA Office - Cliente API Centralizado\n *\n * Este modulo provee un cliente Axios configurado con:\n * - Interceptores de autenticacion (JWT)\n * - Manejo automatico de errores 401 (sesion expirada)\n * - URL base configurada via variable de entorno VITE_API_URL\n *\n * USO:\n * import apiClient from '../utils/api';\n * const response = await apiClient.get('/offices');\n * const data = await apiClient.post('/sales', { ... });\n */\n\nimport axios from 'axios';\nimport { getAuthHeader, logout } from './auth';\n\n// Variable de entorno para Vite (debe comenzar con VITE_)\n// En desarrollo: VITE_API_URL=http://localhost:8001/api\n// En produccion: VITE_API_URL=https://tu-dominio.com/api\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8001/api';\n\n// Crear instancia de Axios con configuracion base\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 30000, // 30 segundos de timeout\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n/**\n * Interceptor de Request\n * Agrega automaticamente el header de autorizacion JWT a todas las peticiones\n */\napiClient.interceptors.request.use(\n  (config) => {\n    const authHeader = getAuthHeader();\n    if (authHeader.Authorization) {\n      config.headers = { ...config.headers, ...authHeader };\n    }\n    return config;\n  },\n  (error) => {\n    console.error('[API] Error en request:', error);\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Interceptor de Response\n * Maneja automaticamente errores de autenticacion (401)\n * redirigiendo al usuario a la pagina de login\n */\napiClient.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    // Manejar error de sesion expirada o no autorizado\n    if (error.response?.status === 401) {\n      console.warn('[API] Sesion expirada o no autorizada. Redirigiendo a login...');\n      logout();\n      window.location.href = '/login';\n    }\n\n    // Manejar errores de red\n    if (!error.response) {\n      console.error('[API] Error de red:', error.message);\n    }\n\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Funcion helper para descargar archivos (reportes, etc.)\n * Maneja blobs y crea links de descarga automaticamente\n *\n * @param {string} endpoint - Endpoint del reporte (ej: '/reports/sales/excel')\n * @param {string} filename - Nombre del archivo a descargar\n * @returns {Promise<void>}\n */\nexport const downloadFile = async (endpoint, filename) => {\n  try {\n    const response = await apiClient.get(endpoint, {\n      responseType: 'blob',\n    });\n\n    const blob = new Blob([response.data], {\n      type: response.headers['content-type'] || 'application/octet-stream'\n    });\n    const url = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url);\n\n    return { success: true };\n  } catch (error) {\n    console.error('[API] Error descargando archivo:', error);\n    throw error;\n  }\n};\n\n// Exportar la URL base para usos especiales (WebSockets, etc.)\nexport const API_URL = API_BASE_URL;\n\n// Alias para compatibilidad con codigo existente (FanPage, OfficesFanPage, etc.)\nexport const API = API_BASE_URL;\n\n// Exportar el cliente como default\nexport default apiClient;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,aAAa,EAAEC,MAAM,QAAQ,QAAQ;;AAE9C;AACA;AACA;AACA,MAAMC,YAAY,GAAGC,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,YAAY,IAAI,2BAA2B;;AAEhF;AACA,MAAMC,SAAS,GAAGR,KAAK,CAACS,MAAM,CAAC;EAC7BC,OAAO,EAAEP,YAAY;EACrBQ,OAAO,EAAE,KAAK;EAAE;EAChBC,OAAO,EAAE;IACP,cAAc,EAAE;EAClB;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACAJ,SAAS,CAACK,YAAY,CAACC,OAAO,CAACC,GAAG,CAC/BC,MAAM,IAAK;EACV,MAAMC,UAAU,GAAGhB,aAAa,CAAC,CAAC;EAClC,IAAIgB,UAAU,CAACC,aAAa,EAAE;IAC5BF,MAAM,CAACJ,OAAO,GAAG;MAAE,GAAGI,MAAM,CAACJ,OAAO;MAAE,GAAGK;IAAW,CAAC;EACvD;EACA,OAAOD,MAAM;AACf,CAAC,EACAG,KAAK,IAAK;EACTC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;EAC/C,OAAOE,OAAO,CAACC,MAAM,CAACH,KAAK,CAAC;AAC9B,CACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAX,SAAS,CAACK,YAAY,CAACU,QAAQ,CAACR,GAAG,CAChCQ,QAAQ,IAAKA,QAAQ,EACrBJ,KAAK,IAAK;EAAA,IAAAK,eAAA;EACT;EACA,IAAI,EAAAA,eAAA,GAAAL,KAAK,CAACI,QAAQ,cAAAC,eAAA,uBAAdA,eAAA,CAAgBC,MAAM,MAAK,GAAG,EAAE;IAClCL,OAAO,CAACM,IAAI,CAAC,gEAAgE,CAAC;IAC9ExB,MAAM,CAAC,CAAC;IACRyB,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;EACjC;;EAEA;EACA,IAAI,CAACV,KAAK,CAACI,QAAQ,EAAE;IACnBH,OAAO,CAACD,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAACW,OAAO,CAAC;EACrD;EAEA,OAAOT,OAAO,CAACC,MAAM,CAACH,KAAK,CAAC;AAC9B,CACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMY,YAAY,GAAG,MAAAA,CAAOC,QAAQ,EAAEC,QAAQ,KAAK;EACxD,IAAI;IACF,MAAMV,QAAQ,GAAG,MAAMf,SAAS,CAAC0B,GAAG,CAACF,QAAQ,EAAE;MAC7CG,YAAY,EAAE;IAChB,CAAC,CAAC;IAEF,MAAMC,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACd,QAAQ,CAACe,IAAI,CAAC,EAAE;MACrCC,IAAI,EAAEhB,QAAQ,CAACX,OAAO,CAAC,cAAc,CAAC,IAAI;IAC5C,CAAC,CAAC;IACF,MAAM4B,GAAG,GAAGb,MAAM,CAACc,GAAG,CAACC,eAAe,CAACN,IAAI,CAAC;IAC5C,MAAMO,IAAI,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;IACxCF,IAAI,CAACd,IAAI,GAAGW,GAAG;IACfG,IAAI,CAACG,QAAQ,GAAGb,QAAQ;IACxBW,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,IAAI,CAAC;IAC/BA,IAAI,CAACM,KAAK,CAAC,CAAC;IACZL,QAAQ,CAACG,IAAI,CAACG,WAAW,CAACP,IAAI,CAAC;IAC/BhB,MAAM,CAACc,GAAG,CAACU,eAAe,CAACX,GAAG,CAAC;IAE/B,OAAO;MAAEY,OAAO,EAAE;IAAK,CAAC;EAC1B,CAAC,CAAC,OAAOjC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;IACxD,MAAMA,KAAK;EACb;AACF,CAAC;;AAED;AACA,OAAO,MAAMkC,OAAO,GAAGlD,YAAY;;AAEnC;AACA,OAAO,MAAMmD,GAAG,GAAGnD,YAAY;;AAE/B;AACA,eAAeK,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}