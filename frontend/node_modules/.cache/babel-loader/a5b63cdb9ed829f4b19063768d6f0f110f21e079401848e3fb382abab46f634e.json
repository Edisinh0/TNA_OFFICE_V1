{"ast":null,"code":"var _jsxFileName = \"/Users/eddiecerpa/Downloads/TNAOffice_MariaDB-2/frontend/src/components/Layout.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { getUser, logout } from '../utils/auth';\nimport apiClient from '../utils/api';\nimport { LayoutDashboard, Calendar, Package, Users, TrendingUp, FileText, Bell, LogOut, Menu, X, Building2, CalendarDays, Car, RefreshCw, GripVertical, Settings2, Check, Shield } from 'lucide-react';\nimport { Button } from './ui/button';\nimport { DndContext, closestCenter, KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';\nimport { arrayMove, SortableContext, sortableKeyboardCoordinates, useSortable, verticalListSortingStrategy } from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst LOGO_URL = 'https://customer-assets.emergentagent.com/job_tnaworkspace/artifacts/joeekgrg_Logo_TNAOffice%20positivo.png';\nconst MENU_ORDER_KEY = 'tna_menu_order';\nconst defaultMenuItems = [{\n  path: '/dashboard',\n  label: 'Dashboard',\n  icon: LayoutDashboard,\n  roles: ['admin', 'comisionista'],\n  moduleId: 'dashboard'\n}, {\n  path: '/resources',\n  label: 'Recursos',\n  icon: Calendar,\n  roles: ['admin', 'comisionista'],\n  moduleId: 'resources'\n}, {\n  path: '/products',\n  label: 'Productos',\n  icon: Package,\n  roles: ['admin'],\n  moduleId: 'products'\n}, {\n  path: '/clients',\n  label: 'Clientes',\n  icon: Users,\n  roles: ['admin'],\n  moduleId: 'clients'\n}, {\n  path: '/offices',\n  label: 'Oficinas',\n  icon: Building2,\n  roles: ['admin'],\n  moduleId: 'offices'\n}, {\n  path: '/parking-storage',\n  label: 'Estac. y Bodegas',\n  icon: Car,\n  roles: ['admin'],\n  moduleId: 'parking-storage'\n}, {\n  path: '/monthly-services',\n  label: 'Servicios Mensuales',\n  icon: RefreshCw,\n  roles: ['admin'],\n  moduleId: 'monthly-services'\n}, {\n  path: '/quotes',\n  label: 'Cotizaciones',\n  icon: FileText,\n  roles: ['admin', 'comisionista'],\n  showQuotesBadge: true,\n  moduleId: 'quotes'\n}, {\n  path: '/comisionistas',\n  label: 'Comisionistas',\n  icon: Users,\n  roles: ['admin'],\n  moduleId: 'comisionistas'\n}, {\n  path: '/tickets',\n  label: 'Ventas',\n  icon: TrendingUp,\n  roles: ['admin', 'comisionista'],\n  moduleId: 'tickets'\n}, {\n  path: '/requests',\n  label: 'Solicitudes',\n  icon: Bell,\n  roles: ['admin', 'comisionista'],\n  showBadge: true,\n  moduleId: 'requests'\n}, {\n  path: '/reports',\n  label: 'Reportes',\n  icon: FileText,\n  roles: ['admin'],\n  moduleId: 'reports'\n}, {\n  path: '/users',\n  label: 'Usuarios',\n  icon: Shield,\n  roles: ['admin'],\n  moduleId: 'users'\n}];\n\n// Componente para cada item del menú que es arrastrable\nconst SortableMenuItem = ({\n  item,\n  isActive,\n  showNotification,\n  newRequestsCount,\n  pendingQuotesCount,\n  onClick,\n  editMode\n}) => {\n  _s();\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging\n  } = useSortable({\n    id: item.path,\n    disabled: !editMode\n  });\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n    zIndex: isDragging ? 1000 : 'auto'\n  };\n  const Icon = item.icon;\n\n  // Determinar si mostrar badge para este item\n  const showRequestsBadge = item.showBadge && newRequestsCount > 0;\n  const showQuotesBadge = item.showQuotesBadge && pendingQuotesCount > 0;\n  const badgeCount = showRequestsBadge ? newRequestsCount : showQuotesBadge ? pendingQuotesCount : 0;\n  const hasBadge = showRequestsBadge || showQuotesBadge;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: setNodeRef,\n    style: style,\n    className: `sidebar-item w-full ${isActive ? 'active' : ''} relative group flex items-center`,\n    children: [editMode && /*#__PURE__*/_jsxDEV(\"button\", {\n      ...attributes,\n      ...listeners,\n      className: \"p-1 mr-1 text-zinc-500 hover:text-zinc-300 cursor-grab active:cursor-grabbing transition-opacity\",\n      title: \"Arrastrar para reordenar\",\n      children: /*#__PURE__*/_jsxDEV(GripVertical, {\n        className: \"w-4 h-4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: onClick,\n      className: \"flex items-center gap-3 flex-1 py-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative\",\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          className: `w-5 h-5 ${hasBadge ? 'text-[#FF8A00]' : ''}`,\n          strokeWidth: 1.5\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 11\n        }, this), hasBadge && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"absolute -top-1 -right-1 w-2 h-2 bg-[#FF8A00] rounded-full animate-pulse\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"font-primary font-medium text-sm\",\n        children: item.label\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), hasBadge && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"ml-auto bg-[#FF8A00] text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center\",\n        children: badgeCount\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n};\n_s(SortableMenuItem, \"iTIyvp0X9kMGpdHRsWsr2+tGbVI=\", false, function () {\n  return [useSortable];\n});\n_c = SortableMenuItem;\nexport const Layout = ({\n  children\n}) => {\n  _s2();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const user = getUser();\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [newRequestsCount, setNewRequestsCount] = useState(0);\n  const [pendingQuotesCount, setPendingQuotesCount] = useState(0);\n  const [menuItems, setMenuItems] = useState([]);\n  const [editMode, setEditMode] = useState(false);\n  const [userAllowedModules, setUserAllowedModules] = useState([]);\n\n  // Cargar perfil del usuario y sus módulos permitidos\n  useEffect(() => {\n    const loadUserProfile = async () => {\n      if (user !== null && user !== void 0 && user.id) {\n        try {\n          const response = await apiClient.get(`/users/${user.id}`);\n          const userData = response.data;\n          if (userData.allowed_modules && userData.allowed_modules.length > 0) {\n            setUserAllowedModules(userData.allowed_modules);\n          } else if (user.role === 'admin') {\n            // Admin tiene acceso a todo por defecto\n            setUserAllowedModules(defaultMenuItems.map(item => item.moduleId));\n          }\n        } catch (error) {\n          console.error('Error loading user profile:', error);\n          // Si falla, usar permisos por rol (comportamiento legacy)\n          if (user.role === 'admin') {\n            setUserAllowedModules(defaultMenuItems.map(item => item.moduleId));\n          }\n        }\n      }\n    };\n    loadUserProfile();\n  }, [user === null || user === void 0 ? void 0 : user.id, user === null || user === void 0 ? void 0 : user.role]);\n\n  // Cargar orden del menú desde localStorage\n  useEffect(() => {\n    const savedOrder = localStorage.getItem(MENU_ORDER_KEY);\n    if (savedOrder) {\n      try {\n        const orderPaths = JSON.parse(savedOrder);\n        // Reordenar según el orden guardado\n        const reorderedItems = orderPaths.map(path => defaultMenuItems.find(item => item.path === path)).filter(Boolean);\n        // Agregar items nuevos que no estaban en el orden guardado\n        const newItems = defaultMenuItems.filter(item => !orderPaths.includes(item.path));\n        setMenuItems([...reorderedItems, ...newItems]);\n      } catch {\n        setMenuItems(defaultMenuItems);\n      }\n    } else {\n      setMenuItems(defaultMenuItems);\n    }\n  }, []);\n  const filteredMenuItems = menuItems.filter(item => {\n    // Primero verificar el rol\n    if (!item.roles.includes(user === null || user === void 0 ? void 0 : user.role)) return false;\n\n    // Si hay módulos permitidos configurados, verificar\n    if (userAllowedModules.length > 0 && item.moduleId) {\n      return userAllowedModules.includes(item.moduleId);\n    }\n\n    // Si no hay configuración de módulos, usar comportamiento por rol\n    return true;\n  });\n\n  // Sensores para drag and drop\n  const sensors = useSensors(useSensor(PointerSensor, {\n    activationConstraint: {\n      distance: 8\n    }\n  }), useSensor(KeyboardSensor, {\n    coordinateGetter: sortableKeyboardCoordinates\n  }));\n\n  // Manejar el fin del drag\n  const handleDragEnd = event => {\n    const {\n      active,\n      over\n    } = event;\n    if (active.id !== (over === null || over === void 0 ? void 0 : over.id)) {\n      setMenuItems(items => {\n        const oldIndex = items.findIndex(item => item.path === active.id);\n        const newIndex = items.findIndex(item => item.path === over.id);\n        const newItems = arrayMove(items, oldIndex, newIndex);\n\n        // Guardar nuevo orden en localStorage\n        const orderPaths = newItems.map(item => item.path);\n        localStorage.setItem(MENU_ORDER_KEY, JSON.stringify(orderPaths));\n        return newItems;\n      });\n    }\n  };\n\n  // Cargar número de solicitudes nuevas y pre-cotizaciones pendientes\n  useEffect(() => {\n    const loadCounts = async () => {\n      try {\n        // Cargar solicitudes nuevas\n        const requestsResponse = await apiClient.get('/requests');\n        const newCount = requestsResponse.data.filter(r => r.status === 'new').length;\n        setNewRequestsCount(newCount);\n\n        // Cargar pre-cotizaciones pendientes\n        const quotesResponse = await apiClient.get('/quotes/pending-count');\n        setPendingQuotesCount(quotesResponse.data.count || 0);\n      } catch (error) {\n        console.error('Error al cargar contadores:', error);\n      }\n    };\n    loadCounts();\n\n    // Recargar cada 30 segundos\n    const interval = setInterval(loadCounts, 30000);\n    return () => clearInterval(interval);\n  }, []);\n  const handleLogout = () => {\n    logout();\n    navigate('/login');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-white flex\",\n    children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n      className: `\n        fixed lg:static inset-y-0 left-0 z-50 w-64 bg-[#050505] border-r border-zinc-900\n        transform transition-transform duration-300 ease-in-out\n        ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n      `,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col h-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-6 border-b border-zinc-900\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: LOGO_URL,\n                alt: \"TNA Office\",\n                className: \"h-10 w-auto object-contain\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 274,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"h-1 w-16 tna-gradient mt-3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 273,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setSidebarOpen(false),\n              className: \"lg:hidden text-white\",\n              children: /*#__PURE__*/_jsxDEV(X, {\n                className: \"w-6 h-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 285,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 281,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-white font-medium font-primary text-sm\",\n              children: user === null || user === void 0 ? void 0 : user.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-zinc-500 text-xs font-primary uppercase\",\n              children: user === null || user === void 0 ? void 0 : user.role\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 290,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"nav\", {\n          className: \"flex-1 overflow-y-auto p-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3 flex justify-end\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setEditMode(!editMode),\n              className: `flex items-center gap-1.5 px-2 py-1 rounded text-xs font-primary transition-all ${editMode ? 'bg-green-600 text-white' : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-300'}`,\n              title: editMode ? 'Finalizar edición' : 'Ordenar menú',\n              children: editMode ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Check, {\n                  className: \"w-3 h-3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 309,\n                  columnNumber: 21\n                }, this), \"Listo\"]\n              }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Settings2, {\n                  className: \"w-3 h-3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 314,\n                  columnNumber: 21\n                }, this), \"Ordenar\"]\n              }, void 0, true)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(DndContext, {\n            sensors: sensors,\n            collisionDetection: closestCenter,\n            onDragEnd: handleDragEnd,\n            children: /*#__PURE__*/_jsxDEV(SortableContext, {\n              items: filteredMenuItems.map(item => item.path),\n              strategy: verticalListSortingStrategy,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"space-y-1\",\n                children: filteredMenuItems.map(item => {\n                  const isActive = location.pathname === item.path;\n                  const showNotification = item.showBadge && newRequestsCount > 0;\n                  return /*#__PURE__*/_jsxDEV(SortableMenuItem, {\n                    item: item,\n                    isActive: isActive,\n                    showNotification: showNotification,\n                    newRequestsCount: newRequestsCount,\n                    pendingQuotesCount: pendingQuotesCount,\n                    editMode: editMode,\n                    onClick: () => {\n                      navigate(item.path);\n                      setSidebarOpen(false);\n                    }\n                  }, item.path, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 336,\n                    columnNumber: 23\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 330,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 border-t border-zinc-900\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            \"data-testid\": \"logout-button\",\n            onClick: handleLogout,\n            variant: \"outline\",\n            className: \"w-full justify-start gap-3 bg-transparent border-zinc-700 text-white hover:bg-zinc-900 rounded-sm font-primary\",\n            children: [/*#__PURE__*/_jsxDEV(LogOut, {\n              className: \"w-5 h-5\",\n              strokeWidth: 1.5\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 15\n            }, this), \"Cerrar Sesi\\xF3n\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex flex-col min-h-screen\",\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"bg-white border-b border-gray-200 p-4 lg:p-6\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setSidebarOpen(true),\n            className: \"lg:hidden text-black\",\n            children: /*#__PURE__*/_jsxDEV(Menu, {\n              className: \"w-6 h-6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-gray-600 text-sm font-primary\",\n              children: \"Badajoz 45, Piso 17, Las Condes\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 383,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 382,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"flex-1 p-4 lg:p-6 bg-gray-50\",\n        children: children\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 7\n    }, this), sidebarOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-black/50 z-40 lg:hidden\",\n      onClick: () => setSidebarOpen(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 262,\n    columnNumber: 5\n  }, this);\n};\n_s2(Layout, \"zvi+FR4dko66ztumCvjNhqmrvx0=\", false, function () {\n  return [useNavigate, useLocation, useSensors, useSensor, useSensor];\n});\n_c2 = Layout;\nvar _c, _c2;\n$RefreshReg$(_c, \"SortableMenuItem\");\n$RefreshReg$(_c2, \"Layout\");","map":{"version":3,"names":["useState","useEffect","useNavigate","useLocation","getUser","logout","apiClient","LayoutDashboard","Calendar","Package","Users","TrendingUp","FileText","Bell","LogOut","Menu","X","Building2","CalendarDays","Car","RefreshCw","GripVertical","Settings2","Check","Shield","Button","DndContext","closestCenter","KeyboardSensor","PointerSensor","useSensor","useSensors","arrayMove","SortableContext","sortableKeyboardCoordinates","useSortable","verticalListSortingStrategy","CSS","jsxDEV","_jsxDEV","Fragment","_Fragment","LOGO_URL","MENU_ORDER_KEY","defaultMenuItems","path","label","icon","roles","moduleId","showQuotesBadge","showBadge","SortableMenuItem","item","isActive","showNotification","newRequestsCount","pendingQuotesCount","onClick","editMode","_s","attributes","listeners","setNodeRef","transform","transition","isDragging","id","disabled","style","Transform","toString","opacity","zIndex","Icon","showRequestsBadge","badgeCount","hasBadge","ref","className","children","title","fileName","_jsxFileName","lineNumber","columnNumber","strokeWidth","_c","Layout","_s2","navigate","location","user","sidebarOpen","setSidebarOpen","setNewRequestsCount","setPendingQuotesCount","menuItems","setMenuItems","setEditMode","userAllowedModules","setUserAllowedModules","loadUserProfile","response","get","userData","data","allowed_modules","length","role","map","error","console","savedOrder","localStorage","getItem","orderPaths","JSON","parse","reorderedItems","find","filter","Boolean","newItems","includes","filteredMenuItems","sensors","activationConstraint","distance","coordinateGetter","handleDragEnd","event","active","over","items","oldIndex","findIndex","newIndex","setItem","stringify","loadCounts","requestsResponse","newCount","r","status","quotesResponse","count","interval","setInterval","clearInterval","handleLogout","src","alt","name","collisionDetection","onDragEnd","strategy","pathname","variant","_c2","$RefreshReg$"],"sources":["/Users/eddiecerpa/Downloads/TNAOffice_MariaDB-2/frontend/src/components/Layout.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { getUser, logout } from '../utils/auth';\nimport apiClient from '../utils/api';\nimport { \n  LayoutDashboard, \n  Calendar, \n  Package, \n  Users, \n  TrendingUp, \n  FileText, \n  Bell, \n  LogOut,\n  Menu,\n  X,\n  Building2,\n  CalendarDays,\n  Car,\n  RefreshCw,\n  GripVertical,\n  Settings2,\n  Check,\n  Shield\n} from 'lucide-react';\nimport { Button } from './ui/button';\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n} from '@dnd-kit/core';\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  verticalListSortingStrategy,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\n\nconst LOGO_URL = 'https://customer-assets.emergentagent.com/job_tnaworkspace/artifacts/joeekgrg_Logo_TNAOffice%20positivo.png';\n\nconst MENU_ORDER_KEY = 'tna_menu_order';\n\nconst defaultMenuItems = [\n  { path: '/dashboard', label: 'Dashboard', icon: LayoutDashboard, roles: ['admin', 'comisionista'], moduleId: 'dashboard' },\n  { path: '/resources', label: 'Recursos', icon: Calendar, roles: ['admin', 'comisionista'], moduleId: 'resources' },\n  { path: '/products', label: 'Productos', icon: Package, roles: ['admin'], moduleId: 'products' },\n  { path: '/clients', label: 'Clientes', icon: Users, roles: ['admin'], moduleId: 'clients' },\n  { path: '/offices', label: 'Oficinas', icon: Building2, roles: ['admin'], moduleId: 'offices' },\n  { path: '/parking-storage', label: 'Estac. y Bodegas', icon: Car, roles: ['admin'], moduleId: 'parking-storage' },\n  { path: '/monthly-services', label: 'Servicios Mensuales', icon: RefreshCw, roles: ['admin'], moduleId: 'monthly-services' },\n  { path: '/quotes', label: 'Cotizaciones', icon: FileText, roles: ['admin', 'comisionista'], showQuotesBadge: true, moduleId: 'quotes' },\n  { path: '/comisionistas', label: 'Comisionistas', icon: Users, roles: ['admin'], moduleId: 'comisionistas' },\n  { path: '/tickets', label: 'Ventas', icon: TrendingUp, roles: ['admin', 'comisionista'], moduleId: 'tickets' },\n  { path: '/requests', label: 'Solicitudes', icon: Bell, roles: ['admin', 'comisionista'], showBadge: true, moduleId: 'requests' },\n  { path: '/reports', label: 'Reportes', icon: FileText, roles: ['admin'], moduleId: 'reports' },\n  { path: '/users', label: 'Usuarios', icon: Shield, roles: ['admin'], moduleId: 'users' },\n];\n\n// Componente para cada item del menú que es arrastrable\nconst SortableMenuItem = ({ item, isActive, showNotification, newRequestsCount, pendingQuotesCount, onClick, editMode }) => {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: item.path, disabled: !editMode });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n    zIndex: isDragging ? 1000 : 'auto',\n  };\n\n  const Icon = item.icon;\n  \n  // Determinar si mostrar badge para este item\n  const showRequestsBadge = item.showBadge && newRequestsCount > 0;\n  const showQuotesBadge = item.showQuotesBadge && pendingQuotesCount > 0;\n  const badgeCount = showRequestsBadge ? newRequestsCount : (showQuotesBadge ? pendingQuotesCount : 0);\n  const hasBadge = showRequestsBadge || showQuotesBadge;\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={style}\n      className={`sidebar-item w-full ${isActive ? 'active' : ''} relative group flex items-center`}\n    >\n      {editMode && (\n        <button\n          {...attributes}\n          {...listeners}\n          className=\"p-1 mr-1 text-zinc-500 hover:text-zinc-300 cursor-grab active:cursor-grabbing transition-opacity\"\n          title=\"Arrastrar para reordenar\"\n        >\n          <GripVertical className=\"w-4 h-4\" />\n        </button>\n      )}\n      <button\n        onClick={onClick}\n        className=\"flex items-center gap-3 flex-1 py-2\"\n      >\n        <div className=\"relative\">\n          <Icon \n            className={`w-5 h-5 ${hasBadge ? 'text-[#FF8A00]' : ''}`} \n            strokeWidth={1.5} \n          />\n          {hasBadge && (\n            <span className=\"absolute -top-1 -right-1 w-2 h-2 bg-[#FF8A00] rounded-full animate-pulse\"></span>\n          )}\n        </div>\n        <span className=\"font-primary font-medium text-sm\">{item.label}</span>\n        {hasBadge && (\n          <span className=\"ml-auto bg-[#FF8A00] text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center\">\n            {badgeCount}\n          </span>\n        )}\n      </button>\n    </div>\n  );\n};\n\nexport const Layout = ({ children }) => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const user = getUser();\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [newRequestsCount, setNewRequestsCount] = useState(0);\n  const [pendingQuotesCount, setPendingQuotesCount] = useState(0);\n  const [menuItems, setMenuItems] = useState([]);\n  const [editMode, setEditMode] = useState(false);\n  const [userAllowedModules, setUserAllowedModules] = useState([]);\n\n  // Cargar perfil del usuario y sus módulos permitidos\n  useEffect(() => {\n    const loadUserProfile = async () => {\n      if (user?.id) {\n        try {\n          const response = await apiClient.get(`/users/${user.id}`);\n          const userData = response.data;\n          if (userData.allowed_modules && userData.allowed_modules.length > 0) {\n            setUserAllowedModules(userData.allowed_modules);\n          } else if (user.role === 'admin') {\n            // Admin tiene acceso a todo por defecto\n            setUserAllowedModules(defaultMenuItems.map(item => item.moduleId));\n          }\n        } catch (error) {\n          console.error('Error loading user profile:', error);\n          // Si falla, usar permisos por rol (comportamiento legacy)\n          if (user.role === 'admin') {\n            setUserAllowedModules(defaultMenuItems.map(item => item.moduleId));\n          }\n        }\n      }\n    };\n    loadUserProfile();\n  }, [user?.id, user?.role]);\n\n  // Cargar orden del menú desde localStorage\n  useEffect(() => {\n    const savedOrder = localStorage.getItem(MENU_ORDER_KEY);\n    if (savedOrder) {\n      try {\n        const orderPaths = JSON.parse(savedOrder);\n        // Reordenar según el orden guardado\n        const reorderedItems = orderPaths\n          .map(path => defaultMenuItems.find(item => item.path === path))\n          .filter(Boolean);\n        // Agregar items nuevos que no estaban en el orden guardado\n        const newItems = defaultMenuItems.filter(\n          item => !orderPaths.includes(item.path)\n        );\n        setMenuItems([...reorderedItems, ...newItems]);\n      } catch {\n        setMenuItems(defaultMenuItems);\n      }\n    } else {\n      setMenuItems(defaultMenuItems);\n    }\n  }, []);\n\n  const filteredMenuItems = menuItems.filter(item => {\n    // Primero verificar el rol\n    if (!item.roles.includes(user?.role)) return false;\n    \n    // Si hay módulos permitidos configurados, verificar\n    if (userAllowedModules.length > 0 && item.moduleId) {\n      return userAllowedModules.includes(item.moduleId);\n    }\n    \n    // Si no hay configuración de módulos, usar comportamiento por rol\n    return true;\n  });\n\n  // Sensores para drag and drop\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    }),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  );\n\n  // Manejar el fin del drag\n  const handleDragEnd = (event) => {\n    const { active, over } = event;\n\n    if (active.id !== over?.id) {\n      setMenuItems((items) => {\n        const oldIndex = items.findIndex(item => item.path === active.id);\n        const newIndex = items.findIndex(item => item.path === over.id);\n        const newItems = arrayMove(items, oldIndex, newIndex);\n        \n        // Guardar nuevo orden en localStorage\n        const orderPaths = newItems.map(item => item.path);\n        localStorage.setItem(MENU_ORDER_KEY, JSON.stringify(orderPaths));\n        \n        return newItems;\n      });\n    }\n  };\n\n  // Cargar número de solicitudes nuevas y pre-cotizaciones pendientes\n  useEffect(() => {\n    const loadCounts = async () => {\n      try {\n        // Cargar solicitudes nuevas\n        const requestsResponse = await apiClient.get('/requests');\n        const newCount = requestsResponse.data.filter(r => r.status === 'new').length;\n        setNewRequestsCount(newCount);\n        \n        // Cargar pre-cotizaciones pendientes\n        const quotesResponse = await apiClient.get('/quotes/pending-count');\n        setPendingQuotesCount(quotesResponse.data.count || 0);\n      } catch (error) {\n        console.error('Error al cargar contadores:', error);\n      }\n    };\n\n    loadCounts();\n    \n    // Recargar cada 30 segundos\n    const interval = setInterval(loadCounts, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const handleLogout = () => {\n    logout();\n    navigate('/login');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-white flex\">\n      {/* Sidebar */}\n      <aside className={`\n        fixed lg:static inset-y-0 left-0 z-50 w-64 bg-[#050505] border-r border-zinc-900\n        transform transition-transform duration-300 ease-in-out\n        ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n      `}>\n        <div className=\"flex flex-col h-full\">\n          {/* Header */}\n          <div className=\"p-6 border-b border-zinc-900\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex-1\">\n                <img \n                  src={LOGO_URL} \n                  alt=\"TNA Office\" \n                  className=\"h-10 w-auto object-contain\"\n                />\n                <div className=\"h-1 w-16 tna-gradient mt-3\"></div>\n              </div>\n              <button \n                onClick={() => setSidebarOpen(false)}\n                className=\"lg:hidden text-white\"\n              >\n                <X className=\"w-6 h-6\" />\n              </button>\n            </div>\n            <div className=\"mt-4\">\n              <p className=\"text-white font-medium font-primary text-sm\">{user?.name}</p>\n              <p className=\"text-zinc-500 text-xs font-primary uppercase\">{user?.role}</p>\n            </div>\n          </div>\n\n          {/* Navigation */}\n          <nav className=\"flex-1 overflow-y-auto p-4\">\n            {/* Botón para activar/desactivar modo edición */}\n            <div className=\"mb-3 flex justify-end\">\n              <button\n                onClick={() => setEditMode(!editMode)}\n                className={`flex items-center gap-1.5 px-2 py-1 rounded text-xs font-primary transition-all ${\n                  editMode \n                    ? 'bg-green-600 text-white' \n                    : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-300'\n                }`}\n                title={editMode ? 'Finalizar edición' : 'Ordenar menú'}\n              >\n                {editMode ? (\n                  <>\n                    <Check className=\"w-3 h-3\" />\n                    Listo\n                  </>\n                ) : (\n                  <>\n                    <Settings2 className=\"w-3 h-3\" />\n                    Ordenar\n                  </>\n                )}\n              </button>\n            </div>\n            \n            <DndContext\n              sensors={sensors}\n              collisionDetection={closestCenter}\n              onDragEnd={handleDragEnd}\n            >\n              <SortableContext\n                items={filteredMenuItems.map(item => item.path)}\n                strategy={verticalListSortingStrategy}\n              >\n                <div className=\"space-y-1\">\n                  {filteredMenuItems.map((item) => {\n                    const isActive = location.pathname === item.path;\n                    const showNotification = item.showBadge && newRequestsCount > 0;\n                    \n                    return (\n                      <SortableMenuItem\n                        key={item.path}\n                        item={item}\n                        isActive={isActive}\n                        showNotification={showNotification}\n                        newRequestsCount={newRequestsCount}\n                        pendingQuotesCount={pendingQuotesCount}\n                        editMode={editMode}\n                        onClick={() => {\n                          navigate(item.path);\n                          setSidebarOpen(false);\n                        }}\n                      />\n                    );\n                  })}\n                </div>\n              </SortableContext>\n            </DndContext>\n          </nav>\n\n          {/* Footer */}\n          <div className=\"p-4 border-t border-zinc-900\">\n            <Button\n              data-testid=\"logout-button\"\n              onClick={handleLogout}\n              variant=\"outline\"\n              className=\"w-full justify-start gap-3 bg-transparent border-zinc-700 text-white hover:bg-zinc-900 rounded-sm font-primary\"\n            >\n              <LogOut className=\"w-5 h-5\" strokeWidth={1.5} />\n              Cerrar Sesión\n            </Button>\n          </div>\n        </div>\n      </aside>\n\n      {/* Main Content */}\n      <div className=\"flex-1 flex flex-col min-h-screen\">\n        {/* Top bar */}\n        <header className=\"bg-white border-b border-gray-200 p-4 lg:p-6\">\n          <div className=\"flex items-center gap-4\">\n            <button\n              onClick={() => setSidebarOpen(true)}\n              className=\"lg:hidden text-black\"\n            >\n              <Menu className=\"w-6 h-6\" />\n            </button>\n            <div className=\"flex-1\">\n              <p className=\"text-gray-600 text-sm font-primary\">Badajoz 45, Piso 17, Las Condes</p>\n            </div>\n          </div>\n        </header>\n\n        {/* Page Content */}\n        <main className=\"flex-1 p-4 lg:p-6 bg-gray-50\">\n          {children}\n        </main>\n      </div>\n\n      {/* Overlay */}\n      {sidebarOpen && (\n        <div \n          className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n          onClick={() => setSidebarOpen(false)}\n        ></div>\n      )}\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}